<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin_layout :: head('Пользователи')}"></head>
<body>
<div th:replace="~{fragments/admin_layout :: sidebar}"></div>
<div class="main-content">
    <div class="card">
        <h2>Пользователи</h2>
        <form class="search-container" th:action="@{/admin/users}" method="get">
            <input type="text" name="q" th:value="${q}" placeholder="Username / Email..." style="width: 300px;"/>
            <input type="hidden" name="sort" th:value="${sort}" />
            <input type="hidden" name="dir" th:value="${dir}" />
            <button type="submit" class="btn btn-dark">Найти</button>
            <a th:href="@{/admin/users}" class="btn">Сброс</a>
        </form>

        <table th:unless="${usersPage.isEmpty()}">
            <thead>
            <tr>
                <th th:data-href="@{/admin/users(sort='id', dir=${sort=='id' and dir=='asc' ? 'desc' : 'asc'}, q=${q})}" onclick="window.location=this.getAttribute('data-href')">ID</th>
                <th th:data-href="@{/admin/users(sort='username', dir=${sort=='username' and dir=='asc' ? 'desc' : 'asc'}, q=${q})}" onclick="window.location=this.getAttribute('data-href')">Username</th>
                <th th:data-href="@{/admin/users(sort='email', dir=${sort=='email' and dir=='asc' ? 'desc' : 'asc'}, q=${q})}" onclick="window.location=this.getAttribute('data-href')">Email</th>
                <th>Активен</th>
                <th>Создан</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${usersPage.content}" th:onclick="|window.location='@{/admin/users/{id}(id=${user.id})}'|" style="cursor: pointer;">
                <td th:text="${user.id}"></td>
                <td th:text="${user.username}"></td>
                <td th:text="${user.email}"></td>
                <td><span th:class="'badge ' + (${user.active} ? 'badge-success' : 'badge-danger')" th:text="${user.active ? 'Да' : 'Нет'}"></span></td>
                <td th:text="${#dates.format(user.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            </tbody>
        </table>

        <ul class="pagination" th:if="${usersPage.totalPages > 1}">
            <li th:classappend="${usersPage.first} ? 'disabled'"><a th:href="@{/admin/users(page=${usersPage.number - 1}, sort=${sort}, dir=${dir}, q=${q})}">←</a></li>
            <li th:each="i : ${#numbers.sequence(0, usersPage.totalPages - 1)}" th:classappend="${i == usersPage.number} ? 'active'"><a th:href="@{/admin/users(page=${i}, sort=${sort}, dir=${dir}, q=${q})}" th:text="${i + 1}"></a></li>
            <li th:classappend="${usersPage.last} ? 'disabled'"><a th:href="@{/admin/users(page=${usersPage.number + 1}, sort=${sort}, dir=${dir}, q=${q})}">→</a></li>
        </ul>
    </div>
</div>
</body>
</html>