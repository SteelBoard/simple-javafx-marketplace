<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<!-- Подключаем HEAD из фрагмента -->
<head th:replace="~{fragments/admin_layout :: head('Админ-панель — Главная')}"></head>
<body>

<!-- Подключаем SIDEBAR из фрагмента -->
<div th:replace="~{fragments/admin_layout :: sidebar}"></div>

<div class="main-content">
    <h2>Обзор магазина</h2>

    <!-- Карточки статистики -->
    <div class="dashboard-grid">
        <div class="stat-card">
            <div class="stat-title">Выручка за сегодня</div>
            <div class="stat-value" th:text="${revenueToday} + ' ₽'">0 ₽</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Заказов за сегодня</div>
            <div class="stat-value" th:text="${ordersToday}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Всего пользователей</div>
            <div class="stat-value" th:text="${totalUsers}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Всего заказов</div>
            <div class="stat-value" th:text="${totalOrders}">0</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">

        <!-- График продаж -->
        <div class="card">
            <h3>Динамика выручки (7 дней)</h3>
            <canvas id="revenueChart"></canvas>
        </div>

        <!-- Топ товаров -->
        <div class="card">
            <h3>Лидеры продаж</h3>
            <table style="font-size: 0.9em;">
                <thead>
                <tr>
                    <th>Товар</th>
                    <th>Продано</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${topProducts}">
                    <td>
                        <a th:href="@{/admin/products/{sku}(sku=${p.sku})}"
                           th:text="${#strings.abbreviate(p.name, 20)}"
                           style="text-decoration: none; color: #3498db; font-weight: bold;"></a>
                    </td>
                    <td th:text="${p.sales}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /* Получаем данные из Java */
    const labels = [[${chartLabels}]];
    const data = [[${chartValues}]];

    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Выручка (₽)',
                data: data,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>

</body>
</html>