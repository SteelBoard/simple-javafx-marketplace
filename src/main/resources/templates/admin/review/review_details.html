<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin_layout :: head('Детали отзыва')}"></head>
<body>

<div th:replace="~{fragments/admin_layout :: sidebar}"></div>

<div class="main-content">
    <div class="card">
        <h2>Модерация отзыва #<span th:text="${review.id}"></span></h2>
        <div th:if="${error}" class="msg-box error" th:text="${error}"></div>
        <div th:if="${param.success}" class="msg-box success">Отзыв успешно обновлен!</div>

        <form th:action="@{/admin/reviews/{id}/update(id=${review.id})}" method="post">
            <table>
                <tr>
                    <th>ID</th>
                    <td th:text="${review.id}"></td>
                </tr>

                <tr>
                    <th>Пользователь</th>
                    <td>
                        <!-- Здесь Username -->
                        <a th:href="@{/admin/users/{uid}(uid=${review.user.id})}" class="link-item"
                           th:text="${review.user.username}">Username</a>
                        <div style="font-size: 0.85em; color: #777; margin-top: 5px;"
                             th:text="|Email: ${review.user.email}|"></div>
                    </td>
                </tr>

                <tr>
                    <th>Товар</th>
                    <td>
                        <a th:href="@{/admin/products/{sku}(sku=${review.product.sku})}" class="link-item"
                           th:text="${review.product.name}">Название товара</a>
                        <div style="font-size: 0.85em; color: #777; margin-top: 5px;"
                             th:text="|Артикул: ${review.product.sku}|"></div>
                    </td>
                </tr>

                <tr>
                    <th>Дата создания</th>
                    <td th:text="${#dates.format(review.createdAt, 'dd MMMM yyyy, HH:mm')}"></td>
                </tr>

                <tr>
                    <th>Рейтинг (1-5)</th>
                    <td>
                        <input type="number" name="rating" min="1" max="5" th:value="${review.rating}" required />
                        <span style="color: #f5c518; font-size: 1.2em;">★</span>
                    </td>
                </tr>

                <tr>
                    <th>Текст отзыва</th>
                    <td>
                        <textarea name="comment" th:text="${review.comment}" placeholder="Текст отзыва..."></textarea>
                    </td>
                </tr>
            </table>

            <div style="margin-top: 20px; max-width: 800px;">
                <button type="submit" class="btn btn-dark">Сохранить изменения</button>
                <a th:href="@{/admin/reviews}" class="btn">← Назад</a>

                <button type="button" class="btn btn-danger"
                        th:onclick="|if(confirm('Удалить отзыв навсегда?')) { document.getElementById('deleteForm').submit(); }|">
                    Удалить отзыв
                </button>
            </div>
        </form>

        <form id="deleteForm" th:action="@{/admin/reviews/{id}/delete(id=${review.id})}" method="post" style="display:none;"></form>

    </div>
</div>
</body>
</html>