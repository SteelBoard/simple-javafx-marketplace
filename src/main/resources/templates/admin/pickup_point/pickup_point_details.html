<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ü–í–ó ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; vertical-align: middle; }
        th { background: #f5f5f5; width: 250px; }

        .btn { padding: 8px 16px; background: #fff; color: #333; border: 1px solid #ccc; text-decoration: none; cursor: pointer; display: inline-block; font-size: 14px; }
        .btn:hover { background: #eee; }
        .btn-dark { background: #333; color: white; border-color: #333; }
        .btn-dark:hover { background: #555; border-color: #555; }

        .msg-box { padding: 10px; margin-bottom: 20px; border-radius: 4px; }
        .error { background-color: #fce4e4; border: 1px solid #fcc2c3; color: #cc0033; }
        .success { background-color: #e6ffe6; border: 1px solid #c3e6cb; color: #155724; }

        input[type="text"] { padding: 6px; width: 100%; max-width: 400px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }

        .links-block { margin: 20px 0; padding: 15px; background: #f9f9f9; border: 1px solid #eee; }
        .links-block a { margin-right: 20px; text-decoration: none; color: #0066cc; font-weight: bold; }
        .links-block a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<h2>–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ #<span th:text="${pickupPoint.id}"></span></h2>

<div th:if="${error}" class="msg-box error" th:text="${error}"></div>
<div th:if="${param.success}" class="msg-box success">–¢–µ–ª–µ—Ñ–æ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</div>

<div class="links-block">
    <span style="color:#666; margin-right:10px;">–î–µ–π—Å—Ç–≤–∏—è:</span>
    <a th:href="@{/admin/orders(search=${'pvz:' + pickupPoint.id})}">üì¶ –ó–∞–∫–∞–∑—ã –Ω–∞ —ç—Ç–æ–º –ü–í–ó</a>
</div>

<form th:action="@{/admin/pickup-points/{id}/update(id=${pickupPoint.id})}" method="post">
    <table>
        <tr>
            <th>ID</th>
            <td th:text="${pickupPoint.id}"></td>
        </tr>

        <tr>
            <th>–°—Ç—Ä–∞–Ω–∞</th>
            <td th:text="${pickupPoint.address.country}"></td>
        </tr>

        <tr>
            <th>–ì–æ—Ä–æ–¥</th>
            <td th:text="${pickupPoint.address.city}" style="font-weight: bold;"></td>
        </tr>

        <tr>
            <th>–£–ª–∏—Ü–∞</th>
            <td th:text="${pickupPoint.address.street}"></td>
        </tr>

        <tr>
            <th>–î–æ–º / –ö–æ—Ä–ø—É—Å</th>
            <td th:text="${pickupPoint.address.houseNumber}"></td>
        </tr>

        <tr>
            <th>–ö–≤–∞—Ä—Ç–∏—Ä–∞ / –û—Ñ–∏—Å</th>
            <td th:text="${pickupPoint.address.apartmentNumber != null ? pickupPoint.address.apartmentNumber : '-'}"></td>
        </tr>

        <tr>
            <th>–ò–Ω–¥–µ–∫—Å</th>
            <td th:text="${pickupPoint.address.postalCode}"></td>
        </tr>

        <tr>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <td>
                <input type="text" id="phoneInput" name="phone"
                       th:value="${pickupPoint.phone}"
                       placeholder="+7 999 000-00-00"
                       maxlength="16"
                       required />
                <div style="font-size: 0.85em; color: #777; margin-top: 5px;">
                    * –§–æ—Ä–º–∞—Ç: +7 XXX XXX-XX-XX
                </div>
            </td>
        </tr>

        <tr>
            <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
            <td th:text="${#dates.format(pickupPoint.address.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
        </tr>
    </table>

    <div style="margin-top: 20px;">
        <button type="submit" class="btn btn-dark">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a th:href="@{/admin/pickup-points}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("phoneInput");

        function formatPhone(value) {
            let digits = value.replace(/\D/g, "");
            if (!digits) return "";
            if (digits[0] === "8") digits = "7" + digits.substring(1);
            if (digits[0] !== "7") digits = "7" + digits;
            digits = digits.substring(0, 11);

            let res = "+7";
            if (digits.length > 1) res += " " + digits.substring(1, 4);
            if (digits.length > 4) res += " " + digits.substring(4, 7);
            if (digits.length > 7) res += "-" + digits.substring(7, 9);
            if (digits.length > 9) res += "-" + digits.substring(9, 11);
            return res;
        }

        input.addEventListener("input", function (e) {
            e.target.value = formatPhone(e.target.value);
        });

        input.addEventListener("focus", function () {
            if (this.value === "") this.value = "+7 ";
        });
    });
</script>

</body>
</html>