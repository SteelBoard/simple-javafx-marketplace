<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin_layout :: head('–î–µ—Ç–∞–ª–∏ –ü–í–ó')}"></head>
<body>

<div th:replace="~{fragments/admin_layout :: sidebar}"></div>

<div class="main-content">
    <div class="card">
        <h2>–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ #<span th:text="${pickupPoint.id}"></span></h2>

        <div th:if="${error}" class="msg-box error" th:text="${error}"></div>
        <div th:if="${param.success}" class="msg-box success">–¢–µ–ª–µ—Ñ–æ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!</div>

        <div class="links-block">
            <span style="color:#666; margin-right:10px;">–î–µ–π—Å—Ç–≤–∏—è:</span>
            <a th:href="@{/admin/orders/pickup-point/{id}(id=${pickupPoint.id})}">üì¶ –ó–∞–∫–∞–∑—ã –Ω–∞ —ç—Ç–æ–º –ü–í–ó</a>
        </div>

        <form th:action="@{/admin/pickup-points/{id}/update(id=${pickupPoint.id})}" method="post">
            <table>
                <tr>
                    <th>ID</th>
                    <td th:text="${pickupPoint.id}"></td>
                </tr>

                <tr>
                    <th>–°—Ç—Ä–∞–Ω–∞</th>
                    <td th:text="${pickupPoint.address.country}"></td>
                </tr>

                <tr>
                    <th>–ì–æ—Ä–æ–¥</th>
                    <td th:text="${pickupPoint.address.city}" style="font-weight: bold;"></td>
                </tr>

                <tr>
                    <th>–£–ª–∏—Ü–∞</th>
                    <td th:text="${pickupPoint.address.street}"></td>
                </tr>

                <tr>
                    <th>–î–æ–º / –ö–æ—Ä–ø—É—Å</th>
                    <td th:text="${pickupPoint.address.houseNumber}"></td>
                </tr>

                <tr>
                    <th>–ö–≤–∞—Ä—Ç–∏—Ä–∞ / –û—Ñ–∏—Å</th>
                    <td th:text="${pickupPoint.address.apartmentNumber != null ? pickupPoint.address.apartmentNumber : '-'}"></td>
                </tr>

                <tr>
                    <th>–ò–Ω–¥–µ–∫—Å</th>
                    <td th:text="${pickupPoint.address.postalCode}"></td>
                </tr>

                <tr>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <td>
                        <input type="text" id="phoneInput" name="phone"
                               th:value="${pickupPoint.phone}"
                               placeholder="+7 999 000-00-00"
                               maxlength="16"
                               required />
                        <div style="font-size: 0.85em; color: #777; margin-top: 5px;">
                            * –§–æ—Ä–º–∞—Ç: +7 XXX XXX-XX-XX
                        </div>
                    </td>
                </tr>

                <tr>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    <td th:text="${#dates.format(pickupPoint.address.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                </tr>
            </table>

            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; display: flex; justify-content: space-between;">
                <button type="submit" class="btn btn-dark">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a th:href="@{/admin/pickup-points}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
                <div></div> <!-- –ü—É—Å—Ç–æ–π –±–ª–æ–∫ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è flex -->

                <!-- –ö–ù–û–ü–ö–ê –£–î–ê–õ–ï–ù–ò–Ø -->
                <form th:action="@{/admin/pickup-points/{id}/delete(id=${pickupPoint.id})}" method="post">
                    <button type="submit" class="btn btn-danger"
                            onclick="return confirm('–í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏? \n–≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ –Ω–µ–º –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.');">
                        –£–¥–∞–ª–∏—Ç—å –ü–í–ó
                    </button>
                </form>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("phoneInput");

        function formatPhone(value) {
            let digits = value.replace(/\D/g, "");
            if (!digits) return "";
            if (digits[0] === "8") digits = "7" + digits.substring(1);
            if (digits[0] !== "7") digits = "7" + digits;
            digits = digits.substring(0, 11);

            let res = "+7";
            if (digits.length > 1) res += " " + digits.substring(1, 4);
            if (digits.length > 4) res += " " + digits.substring(4, 7);
            if (digits.length > 7) res += "-" + digits.substring(7, 9);
            if (digits.length > 9) res += "-" + digits.substring(9, 11);
            return res;
        }

        input.addEventListener("input", function (e) {
            e.target.value = formatPhone(e.target.value);
        });

        input.addEventListener("focus", function () {
            if (this.value === "") this.value = "+7 ";
        });
    });
</script>

</body>
</html>