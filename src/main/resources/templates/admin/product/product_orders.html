<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin_layout :: head('Заказы товара')}"></head>
<body>

<div th:replace="~{fragments/admin_layout :: sidebar}"></div>

<div class="main-content">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>Заказы с товаром: <span th:text="${product.name}" style="color: #777;"></span></h2>
            <a th:href="@{/admin/products/{sku}(sku=${product.sku})}" class="btn">← Назад к товару</a>
        </div>

        <div th:if="${ordersPage.isEmpty()}" class="no-data">Заказов нет.</div>

        <table th:unless="${ordersPage.isEmpty()}">
            <thead>
            <tr>
                <th>№ Заказа</th>
                <th>Покупатель</th>
                <th>Статус</th>
                <th>Дата</th>
                <th>Сумма</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${ordersPage.content}" th:onclick="|window.location='@{/admin/orders/{id}(id=${order.id})}'|" style="cursor: pointer;">
                <td th:text="'#' + ${order.id}"></td>
                <td onclick="event.stopPropagation()">
                    <a th:href="@{/admin/users/{id}(id=${order.user.id})}" th:text="${order.user.username}"></a>
                </td>
                <td>
                     <span th:class="'badge ' + (${order.status.name() == 'COMPLETED'} ? 'badge-success' : (${order.status.name() == 'CANCELLED'} ? 'badge-danger' : 'badge-warning'))"
                           th:text="${order.status}"></span>
                </td>
                <td th:text="${#dates.format(order.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                <td th:text="${order.totalAmount} + ' ₽'"></td>
            </tr>
            </tbody>
        </table>

        <!-- Пагинация -->
        <ul class="pagination" th:if="${ordersPage.totalPages > 1}">
            <li th:classappend="${ordersPage.first} ? 'disabled'">
                <a th:href="@{/admin/products/{sku}/orders(sku=${product.sku}, page=${ordersPage.number - 1})}">←</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, ordersPage.totalPages - 1)}" th:classappend="${i == ordersPage.number} ? 'active'">
                <a th:href="@{/admin/products/{sku}/orders(sku=${product.sku}, page=${i})}" th:text="${i + 1}"></a>
            </li>
            <li th:classappend="${ordersPage.last} ? 'disabled'">
                <a th:href="@{/admin/products/{sku}/orders(sku=${product.sku}, page=${ordersPage.number + 1})}">→</a>
            </li>
        </ul>
    </div>
</div>
</body>
</html>