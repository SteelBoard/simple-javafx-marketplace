<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Товары</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .search-container { margin-bottom: 20px; display: flex; gap: 10px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f5f5f5; cursor: pointer; }
        tr:hover { background: #f9f9f9; cursor: pointer; }
        .pagination { list-style: none; display: flex; gap: 5px; padding: 0; }
        .pagination li a { padding: 6px 10px; border: 1px solid #ccc; text-decoration: none; color: black; }
        .pagination .active a { background: #333; color: white; }
    </style>
</head>
<body>
<h2>Товары</h2>

<form class="search-container" th:action="@{/admin/products}" method="get">
    <input type="text" name="search" th:value="${search}" placeholder="Поиск..." style="padding: 5px; width: 300px;"/>
    <input type="hidden" name="sort" th:value="${sort}" /> <input type="hidden" name="dir" th:value="${dir}" /> <input type="hidden" name="size" th:value="${size}" />
    <button type="submit" style="padding: 6px;">Найти</button>
    <a th:href="@{/admin/products}" style="padding: 6px; text-decoration: none; color: black; border: 1px solid #ccc;">Сброс</a>
</form>

<table>
    <thead>
    <tr>
        <th th:data-href="@{/admin/products(sort='id',dir=${sort=='id' and dir=='asc' ? 'desc' : 'asc'},size=${size},search=${search})}" onclick="window.location=this.getAttribute('data-href')">ID</th>
        <th th:data-href="@{/admin/products(sort='name',dir=${sort=='name' and dir=='asc' ? 'desc' : 'asc'},size=${size},search=${search})}" onclick="window.location=this.getAttribute('data-href')">Название</th>
        <th th:data-href="@{/admin/products(sort='price',dir=${sort=='price' and dir=='asc' ? 'desc' : 'asc'},size=${size},search=${search})}" onclick="window.location=this.getAttribute('data-href')">Цена</th>
        <th th:data-href="@{/admin/products(sort='sales',dir=${sort=='sales' and dir=='asc' ? 'desc' : 'asc'},size=${size},search=${search})}" onclick="window.location=this.getAttribute('data-href')">Продажи</th>
        <th>Активен</th>
        <th th:data-href="@{/admin/products(sort='createdAt',dir=${sort=='createdAt' and dir=='asc' ? 'desc' : 'asc'},size=${size},search=${search})}" onclick="window.location=this.getAttribute('data-href')">Создан</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="p : ${productsPage.content}" th:onclick="|window.location='@{/admin/products/{id}(id=${p.id})}'|">
        <td th:text="${p.id}"></td>
        <td th:text="${p.name}"></td>
        <td th:text="${p.price}"></td>
        <td th:text="${p.sales}"></td>
        <td th:text="${p.active ? 'Да' : 'Нет'}" th:style="${p.active ? 'color:green' : 'color:red'}"></td>
        <td th:text="${#dates.format(p.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
    </tr>
    </tbody>
</table>
<!-- Пагинация простая -->
<ul class="pagination" th:if="${productsPage.totalPages > 1}">
    <li th:each="i : ${#numbers.sequence(0, productsPage.totalPages - 1)}" th:classappend="${i == productsPage.number} ? 'active'">
        <a th:href="@{/admin/products(page=${i},size=${size},sort=${sort},dir=${dir},search=${search})}" th:text="${i + 1}"></a>
    </li>
</ul>
</body>
</html>