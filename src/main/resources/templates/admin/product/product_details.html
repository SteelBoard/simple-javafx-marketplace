<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Админка — Редактирование товара</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #f5f5f5; text-align: left; width: 200px; }
        .btn { padding: 6px 14px; border: 1px solid #333; background: #333; color: white; cursor: pointer; }
        .btn:hover { background: #555; }
        .error { color: red; font-size: 0.9em; }
        .images { display: flex; gap: 10px; margin-top: 10px; }
        .images img { width: 100px; height: 100px; object-fit: cover; }
        .links a { margin-right: 15px; text-decoration: none; color: #0066cc; }
        .links a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<h2>Редактирование товара</h2>

<form th:action="@{/admin/products/{id}/update(id=${product.id})}"
      th:object="${productDto}" method="post">
    <table>
        <tr>
            <th>ID</th>
            <td th:text="${product.id}"></td>
        </tr>

        <tr>
            <th>Название</th>
            <td>
                <input type="text" th:field="*{name}" />
                <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error"></div>
            </td>
        </tr>

        <tr>
            <th>Описание</th>
            <td>
                <textarea th:field="*{description}" rows="4" cols="50"></textarea>
                <div th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="error"></div>
            </td>
        </tr>

        <tr>
            <th>Цена</th>
            <td>
                <input type="number" step="0.01" th:field="*{price}" />
                <div th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="error"></div>
            </td>
        </tr>

        <tr>
            <th>Активен</th>
            <td>
                <input type="checkbox" th:field="*{active}" />
            </td>
        </tr>

        <tr>
            <th>Фотографии</th>
            <td>
                <div class="images">
                    <div th:each="img : ${product.images}">
                        <img th:src="@{${img.filepath}}" alt="Фото" />

                        <form th:action="@{/admin/products/images/delete}" method="post" style="display:inline">
                            <input type="hidden" name="productId" th:value="${product.id}" />
                            <input type="hidden" name="imageId" th:value="${img.id}" />
                            <button type="submit" class="btn">Удалить</button>
                        </form>
                    </div>
                </div>
            </td>
        </tr>

    </table>

    <div style="margin-top: 15px;">
        <button type="submit" class="btn">Сохранить</button>
        <a th:href="@{/admin/products}" class="btn">← Назад к списку</a>
    </div>
</form>

<div class="links" style="margin-top: 30px;">
    <a th:href="@{/admin/products/{id}/reviews(id=${product.id})}">Отзывы на товар</a>
    <a th:href="@{/admin/products/{id}/orders(id=${product.id})}">Заказы товара</a>
    <a th:href="@{/admin/users/{id}(id=${product.seller.id})}">Профиль продавца</a>
</div>

</body>
</html>
