<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/admin_layout :: head('–¢–æ–≤–∞—Ä: ' + ${product.sku})}"></head>
<style>
    /* –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .images-grid { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    .image-card { border: 1px solid #ddd; padding: 5px; text-align: center; border-radius: 4px; background: #fff;}
    .image-card img { width: 100px; height: 100px; object-fit: cover; display: block; margin-bottom: 5px; }
    .nav-top { margin-bottom: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; }
    .nav-top a { margin-right: 15px; text-decoration: none; color: #0066cc; font-weight: bold; }
    .nav-top a:hover { text-decoration: underline; }
</style>
<body>

<div th:replace="~{fragments/admin_layout :: sidebar}"></div>

<div class="main-content">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>–¢–æ–≤–∞—Ä: <span th:text="${product.name}"></span></h2>
            <a th:href="@{/admin/products}" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-top">
            <span style="color: #666; margin-right: 10px;">–ü–µ—Ä–µ–π—Ç–∏:</span>
            <a th:href="@{/admin/products/{sku}/orders(sku=${product.sku})}">üì¶ –ó–∞–∫–∞–∑—ã</a>
            <a th:href="@{/admin/products/{sku}/reviews(sku=${product.sku})}">üí¨ –û—Ç–∑—ã–≤—ã</a>
            <a th:href="@{/product/{sku}(sku=${product.sku})}" target="_blank">üîó –ù–∞ —Å–∞–π—Ç</a>
        </div>

        <div th:if="${param.success}" class="badge badge-success" style="padding: 10px; display: block; margin-bottom: 15px;">–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</div>

        <form th:action="@{/admin/products/{sku}/update(sku=${product.sku})}" th:object="${productDto}" method="post">
            <table>
                <tr>
                    <th style="width: 200px;">–ê—Ä—Ç–∏–∫—É–ª</th>
                    <td th:text="${product.sku}" style="font-weight: bold;"></td>
                </tr>
                <tr>
                    <th>–ü—Ä–æ–¥–∞–≤–µ—Ü</th>
                    <td>
                        <a th:href="@{/admin/users/{id}(id=${product.seller.id})}" th:text="${product.seller.username}"></a>
                        <span style="color: gray;">(ID: <span th:text="${product.seller.id}"></span>)</span>
                    </td>
                </tr>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <td>
                        <input type="text" th:field="*{name}" style="width: 100%; max-width: 500px;" required/>
                        <div style="color: red;" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </td>
                </tr>
                <tr>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <td>
                        <textarea th:field="*{description}" style="width: 100%; height: 100px; max-width: 500px; resize: none;"></textarea>
                    </td>
                </tr>
                <tr>
                    <th>–¶–µ–Ω–∞</th>
                    <td>
                        <input type="number" step="0.01" th:field="*{price}" style="width: 150px;" required/> ‚ÇΩ
                    </td>
                </tr>
                <tr>
                    <th>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</th>
                    <td>–†–µ–π—Ç–∏–Ω–≥: <b th:text="${product.rating}"></b> ‚òÖ, –ü—Ä–æ–¥–∞–∂–∏: <b th:text="${product.sales}"></b></td>
                </tr>
                <tr>
                    <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                    <td>
                        <label><input type="checkbox" th:field="*{active}" style="transform: scale(1.2); margin-right: 5px;"> –ü–æ–∫–∞–∑–∞—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</label>
                    </td>
                </tr>
                <tr>
                    <th>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</th>
                    <td>
                        <div class="images-grid">
                            <div th:each="img : ${product.images}" class="image-card"
                                 th:style="${img.type.name() == 'MAIN'} ? 'border: 2px solid #2ecc71; background: #eaffea;' : ''">
                                <img th:src="@{${img.filepath}}" />
                                <div th:if="${img.type.name() == 'MAIN'}" style="color: #2ecc71; font-weight: bold; font-size: 12px;">–ì–õ–ê–í–ù–ê–Ø</div>
                                <div style="display: flex; gap: 5px; justify-content: center; margin-top: 5px;">
                                    <button th:if="${img.type.name() != 'MAIN'}" type="submit" class="btn btn-primary"
                                            style="padding: 2px 6px; font-size: 12px;"
                                            th:formaction="@{/admin/products/{sku}/images/set-main(sku=${product.sku})}"
                                            name="imageId" th:value="${img.id}">‚òÖ</button>
                                    <button type="submit" class="btn btn-danger"
                                            style="padding: 2px 6px; font-size: 12px;"
                                            th:formaction="@{/admin/products/{sku}/images/delete(sku=${product.sku})}"
                                            name="imageId" th:value="${img.id}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å?');">X</button>
                                </div>
                            </div>
                        </div>

                        <div th:if="${product.images.size() < 11}" style="margin-top: 10px; padding: 10px; border: 1px dashed #ccc; display: inline-block;">
                            <b>–î–æ–±–∞–≤–∏—Ç—å:</b>
                            <input type="file" name="file" accept="image/*" style="border: none;">
                            <button type="submit" class="btn btn-dark" style="padding: 4px 10px;"
                                    th:formaction="@{/admin/products/{sku}/images/add(sku=${product.sku})}"
                                    th:formenctype="'multipart/form-data'">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        </div>
                    </td>
                </tr>
            </table>

            <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button type="submit" class="btn btn-danger"
                        th:formaction="@{/admin/products/{sku}/delete(sku=${product.sku})}"
                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –í–ï–°–¨ –¢–û–í–ê–†?');">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>